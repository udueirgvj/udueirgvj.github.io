<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>إنشاء حساب</title>
<style>
body{background:#0b1622;font-family:tahoma;color:white;text-align:center;margin-top:80px}
input{width:80%;padding:12px;margin:8px;border-radius:8px;border:none}
button{padding:12px 20px;background:#28c76f;color:white;border:none;border-radius:8px}
</style>
</head>
<body>

<h2>إنشاء حساب</h2>

<input id="username" placeholder="@username">
<input id="email" placeholder="email">
<input id="password" type="password" placeholder="password">

<br>
<button onclick="register()">إنشاء الحساب</button>
<br><br>
<a href="login.html" style="color:#4fc3f7">تسجيل الدخول</a>

<script type="module">
import { auth, db } from "./app/firebase.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

window.register = async function(){

let username=document.getElementById("username").value.trim();
let email=document.getElementById("email").value.trim();
let password=document.getElementById("password").value.trim();

if(!username.startsWith("@")){alert("اسم المستخدم يجب أن يبدأ بـ @");return;}

let clean=username.replace("@","");

const snap=await get(child(ref(db),"usernames/"+clean));
if(snap.exists()){alert("اسم المستخدم مستخدم");return;}

const userCred=await createUserWithEmailAndPassword(auth,email,password);
const uid=userCred.user.uid;

await set(ref(db,"users/"+uid),{username:username,email:email});
await set(ref(db,"usernames/"+clean),uid);

alert("تم إنشاء الحساب");
window.location="login.html";
}
</script>

</body>
</html>
