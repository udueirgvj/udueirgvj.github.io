<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clipn</title>

<style>
body{
margin:0;
font-family:tahoma;
background:linear-gradient(#0b1c2a,#07131d);
color:white;
}

/* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
.topbar{
height:60px;
background:#0f2a3d;
display:flex;
align-items:center;
justify-content:space-between;
padding:0 15px;
box-shadow:0 2px 10px rgba(0,0,0,.4);
}

.menu{
font-size:26px;
cursor:pointer;
}

.title{
font-size:22px;
font-weight:bold;
}

.search{
font-size:22px;
cursor:pointer;
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª */
#chatList{
padding:10px;
}

.user{
background:#112c40;
padding:15px;
border-radius:12px;
margin-bottom:10px;
cursor:pointer;
}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« (Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙƒØ§Ù†Øª Ù‡Ù†Ø§ ÙˆØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡Ø§) */
#searchBox{
position:fixed;
top:0;
left:0;
right:0;
bottom:0;
background:rgba(0,0,0,.7);
display:none;
align-items:center;
justify-content:center;
z-index:20;
pointer-events:none;
}

.searchContent{
background:#0f2a3d;
padding:20px;
border-radius:15px;
width:85%;
max-width:400px;
}

#searchInput{
width:100%;
padding:12px;
border-radius:8px;
border:none;
margin-bottom:10px;
}

.result{
background:#163a54;
padding:12px;
border-radius:10px;
margin-top:8px;
cursor:pointer;
}
</style>
</head>

<body>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
<div class="topbar">
<div class="menu">â˜°</div>
<div class="title">Clipn</div>
<div class="search" onclick="openSearch()">ðŸ”Ž</div>
</div>

<!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª -->
<div id="chatList"></div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø­Ø« -->
<div id="searchBox">
  <div class="searchContent">
    <input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <div id="results"></div>
  </div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ³ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ */
const firebaseConfig = {
apiKey: "AIzaSyDRCtfuYrEdnuKUsWu_79NC6G_xGLznBJc",
authDomain: "tttrt-b8c5a.firebaseapp.com",
databaseURL: "https://tttrt-b8c5a-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId: "tttrt-b8c5a",
storageBucket: "tttrt-b8c5a.firebasestorage.app",
messagingSenderId: "975123752593",
appId: "1:975123752593:web:e591e930af3a3e29568130"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ÙØªØ­ Ø§Ù„Ø¨Ø­Ø« */
window.openSearch = ()=>{
let box=document.getElementById("searchBox");
box.style.display="flex";
box.style.pointerEvents="auto";
};

/* Ø§ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ø­Ø« */
document.getElementById("searchBox").onclick=(e)=>{
if(e.target.id=="searchBox"){
let box=document.getElementById("searchBox");
box.style.display="none";
box.style.pointerEvents="none";
}
};

/* Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
document.getElementById("searchInput").oninput=async function(){

let name=this.value.trim().toLowerCase();
let results=document.getElementById("results");
results.innerHTML="";

if(name.length<2) return;

const snapshot=await get(child(ref(db),"users"));

if(snapshot.exists()){
snapshot.forEach(user=>{
let data=user.val();
if(data.username.toLowerCase().includes(name)){

let div=document.createElement("div");
div.className="result";
div.innerText="@"+data.username;

div.onclick=()=>{
localStorage.setItem("chatWith",user.key);
localStorage.setItem("chatName",data.username);
window.location="chat.html";
};

results.appendChild(div);
}
});
}

};

</script>

</body>
</html>
