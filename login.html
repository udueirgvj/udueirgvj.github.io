<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل الدخول</title>
<style>
body{background:#0b1622;font-family:tahoma;color:white;text-align:center;margin-top:80px}
input{width:80%;padding:12px;margin:8px;border-radius:8px;border:none}
button{padding:12px 20px;background:#3498db;color:white;border:none;border-radius:8px}
</style>
</head>
<body>

<h2>تسجيل الدخول</h2>

<input id="username" placeholder="@username">
<input id="password" type="password" placeholder="password">

<br>
<button onclick="login()">دخول</button>
<br><br>
<a href="register.html" style="color:#4fc3f7">إنشاء حساب</a>

<script type="module">
import { auth, db } from "./app/firebase.js";
import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

window.login = async function(){

let username=document.getElementById("username").value.trim();
let password=document.getElementById("password").value.trim();

let clean=username.replace("@","");

const snap=await get(child(ref(db),"usernames/"+clean));
if(!snap.exists()){alert("المستخدم غير موجود");return;}

const uid=snap.val();
const userData=await get(child(ref(db),"users/"+uid));
const email=userData.val().email;

await signInWithEmailAndPassword(auth,email,password);

localStorage.setItem("chatUID",uid);
localStorage.setItem("chatUser",username);

window.location="app/index.html";
}
</script>

</body>
</html>
