<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªÙŠÙ„Ø±ÙÙŠØ¨</title>
<style>
body{margin:0;font-family:Arial;background:#f0f2f5}

/* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
.header{background:linear-gradient(45deg,#6d83f2,#6a5acd);color:white;padding:14px;display:flex;justify-content:space-between;align-items:center}
.icon{font-size:22px;cursor:pointer}
.title{font-size:18px}

/* Ø§Ù„Ø¨Ø­Ø« */
.searchBox{display:none;padding:10px;background:white}
.searchBox input{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */
.users{padding:10px}
.user{background:linear-gradient(45deg,#6d83f2,#6a5acd);color:white;padding:15px;border-radius:16px;margin-bottom:10px;cursor:pointer}
.user:hover{opacity:0.9}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙˆØ§Ù„Ù‚Ù†ÙˆØ§Øª */
.group,.channel{padding:14px;background:#6a5acd;color:white;margin:10px;border-radius:16px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.group:hover,.channel:hover{opacity:0.9}

/* Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
.chatBox{flex:1;padding:10px;overflow-y:auto;display:flex;flex-direction:column}
.message{padding:8px 12px;border-radius:16px;margin:6px 0;max-width:70%;display:inline-block}
.sender{background:#6d83f2;color:white;align-self:flex-end}
.receiver{background:#e4e6eb;color:black;align-self:flex-start}
.inputArea{display:flex;padding:10px;background:white}
.inputArea input{flex:1;padding:10px;border-radius:20px;border:1px solid #ccc}
.inputArea button{margin-left:6px;padding:10px 14px;border:none;background:#6d83f2;color:white;border-radius:50%;cursor:pointer}

/* Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
.addBtn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;background:#6d83f2;color:white;font-size:30px;border:none}
</style>
</head>
<body>

<div class="header">
  <div class="icon" onclick="toggleSearch()">ğŸ”</div>
  <div class="title">ØªÙŠÙ„Ø±ÙÙŠØ¨</div>
  <div class="icon">â˜°</div>
</div>

<div class="searchBox" id="searchBox">
  <input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…..." oninput="searchUser()">
</div>

<div id="mainContent">
  <div class="users" id="userList"></div>
</div>

<button class="addBtn" onclick="createGroup()">+</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "Ø¶Ø¹_Ø¨ÙŠØ§Ù†Ø§ØªÙƒ",
  authDomain: "Ø¶Ø¹_Ø¨ÙŠØ§Ù†Ø§ØªÙƒ",
  databaseURL: "Ø¶Ø¹_Ø¨ÙŠØ§Ù†Ø§ØªÙƒ",
  projectId: "Ø¶Ø¹_Ø¨ÙŠØ§Ù†Ø§ØªÙƒ"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ø¤Ù‚Øª
const currentUser="user1";

// =================== Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ===================
function toggleSearch(){
  let box=document.getElementById("searchBox");
  box.style.display=box.style.display=="block"?"none":"block";
}

function searchUser(){
  let text=document.getElementById("searchInput").value.toLowerCase();
  db.ref("users").once("value",snap=>{
    let data=snap.val(); let html="";
    for(let id in data){
      let name=data[id].name.toLowerCase();
      if(name.includes(text)){
        html+=`<div class="user" onclick="openChat('${id}')">${data[id].name}</div>`;
      }
    }
    document.getElementById("userList").innerHTML=html;
  });
}

// ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø© ÙØ±Ø¯ÙŠØ©
function openChat(userId){
  localStorage.setItem("chatWith",userId);
  renderChatPage();
}

// =================== Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ===================
function createGroup(){
  let name=prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:");
  if(name) db.ref("groups").push({name, members: [currentUser]});
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
function loadGroups(){
  db.ref("groups").on("value",snap=>{
    let data=snap.val(); let html="";
    for(let id in data){
      html+=`<div class="group" onclick="openGroup('${id}')">${data[id].name}</div>`;
    }
    document.getElementById("mainContent").innerHTML=html;
  });
}

// ÙØªØ­ Ù…Ø¬Ù…ÙˆØ¹Ø©
function openGroup(groupId){
  localStorage.setItem("groupId",groupId);
  renderGroupChatPage();
}

// =================== Ø§Ù„Ù‚Ù†ÙˆØ§Øª ===================
function loadChannels(){
  db.ref("channels").on("value",snap=>{
    let data=snap.val(); let html="";
    for(let id in data){
      html+=`<div class="channel" onclick="openChannel('${id}')">${data[id].name} <span>${data[id].subscribers||0} Ù…Ø´ØªØ±Ùƒ</span></div>`;
    }
    document.getElementById("mainContent").innerHTML=html;
  });
}

// ÙØªØ­ Ù‚Ù†Ø§Ø©
function openChannel(channelId){
  localStorage.setItem("channelId",channelId);
  renderChannelPage();
}

// =================== Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ÙØ±Ø¯ÙŠØ© ===================
function renderChatPage(){
  document.getElementById("mainContent").innerHTML=`
    <div class="chatBox" id="chatBox"></div>
    <div class="inputArea">
      <input id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." onkeypress="if(event.key==='Enter'){sendMessage();}">
      <button onclick="sendMessage()">â¤</button>
    </div>
  `;
  loadMessages();
}

function getChatId(){
  const chatWith=localStorage.getItem("chatWith");
  return currentUser<chatWith?currentUser+"_"+chatWith:chatWith+"_"+currentUser;
}

function loadMessages(){
  db.ref("chats/"+getChatId()).on("value",snap=>{
    let data=snap.val(); let html="";
    for(let id in data){
      let cls=data[id].sender===currentUser?"sender":"receiver";
      html+=`<div class="message ${cls}">${data[id].text}</div>`;
    }
    document.getElementById("chatBox").innerHTML=html;
    document.getElementById("chatBox").scrollTop=document.getElementById("chatBox").scrollHeight;
  });
}

function sendMessage(){
  let input=document.getElementById("msgInput");
  let text=input.value.trim(); if(text==="") return;
  db.ref("chats/"+getChatId()).push({sender:currentUser,text});
  input.value="";
}

// =================== Ø¨ÙˆØªØ§Øª Ø¨Ø³ÙŠØ·Ø© ===================
function createBot(name,commands){
  db.ref("bots").push({name,commands});
}

function handleBot(message){
  db.ref("bots").once("value",snap=>{
    let bots=snap.val();
    for(let id in bots){
      let bot=bots[id];
      bot.commands.forEach(cmd=>{
        if(message===cmd.trigger){
          alert("Ø¨ÙˆØª "+bot.name+" : "+cmd.response);
        }
      });
    }
  });
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
db.ref("users").once("value",snap=>{
  let data=snap.val(); let html="";
  for(let id in data){
    if(id!==currentUser) html+=`<div class="user" onclick="openChat('${id}')">${data[id].name}</div>`;
  }
  document.getElementById("userList").innerHTML=html;
});
</script>

</body>
</html>
