<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>إنشاء حساب</title>

<link rel="stylesheet" href="style.css">

<style>
body{
background:#0b1f2a;
font-family:Tahoma;
color:white;
text-align:center;
}

.box{
width:90%;
max-width:420px;
margin:60px auto;
padding:25px;
background:#112f3d;
border-radius:14px;
}

input{
width:100%;
padding:14px;
margin:10px 0;
border-radius:10px;
border:none;
font-size:16px;
}

button{
width:100%;
padding:14px;
margin-top:15px;
background:#2ecc71;
border:none;
border-radius:10px;
font-size:18px;
color:white;
cursor:pointer;
}

.msg{
margin-top:10px;
color:#ff7675;
}
</style>
</head>

<body>

<div class="box">
<h2>إنشاء حساب</h2>

<input id="username" placeholder="اسم المستخدم (5 أحرف على الأقل)">
<input id="email" type="email" placeholder="البريد الإلكتروني">
<input id="password" type="password" placeholder="كلمة المرور">

<button id="createBtn">إنشاء الحساب</button>

<div class="msg" id="msg"></div>

<p style="margin-top:15px;">
لديك حساب؟ 
<a href="./login.html" style="color:#00d2ff;">تسجيل الدخول</a>
</p>
</div>


<!-- Firebase -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import { getDatabase, ref, set, get, child } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";


const firebaseConfig = {
  apiKey: "AIzaSyDRCtfuYrEdnuKUsWu_79NC6G_xGLznBJc",
  authDomain: "tttrt-b8c5a.firebaseapp.com",
  databaseURL: "https://tttrt-b8c5a-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "tttrt-b8c5a",
  storageBucket: "tttrt-b8c5a.appspot.com",
  messagingSenderId: "975123752593",
  appId: "1:975123752593:web:e591e930af3a3e29568130"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);


const btn = document.getElementById("createBtn");
const msg = document.getElementById("msg");

btn.onclick = async () => {

msg.innerText = "";

const username = document.getElementById("username").value.trim();
const email = document.getElementById("email").value.trim();
const password = document.getElementById("password").value.trim();

if(username.length < 5){
msg.innerText = "اسم المستخدم يجب أن يكون 5 أحرف على الأقل";
return;
}

if(email === "" || password === ""){
msg.innerText = "أكمل جميع الحقول";
return;
}

try{

// فحص تكرار اسم المستخدم
const snapshot = await get(child(ref(db), "usernames/" + username));

if(snapshot.exists()){
msg.innerText = "اسم المستخدم مستخدم مسبقاً";
return;
}

// إنشاء الحساب
const userCredential = await createUserWithEmailAndPassword(auth, email, password);
const user = userCredential.user;

// حفظ البيانات
await set(ref(db, "users/" + user.uid), {
username: username,
email: email,
uid: user.uid
});

// حجز اسم المستخدم
await set(ref(db, "usernames/" + username), user.uid);

// التحويل الصحيح
msg.style.color = "#2ecc71";
msg.innerText = "تم إنشاء الحساب...";

setTimeout(()=>{
window.location.assign("./index.html");
},800);

}catch(error){
msg.innerText = error.message;
}

};

</script>

</body>
</html>
